<div align="center">
<a href="http://camma.u-strasbg.fr/">
<img src="figs/camma_logo_tr.png" width="20%">
</a>
</div>

## **A Skull-Adaptive Framework for AI-Based 3D Transcranial Focused Ultrasound Simulation**

_Vinkle Srivastav, Juliette Puel, Jonathan Vappou, Elijah Van Houten, Paolo Cabras*, Nicolas Padoy*_
*co-last authors


<div align="center">
  <img src="figs/dataset.gif" width="1200px" />
</div>

#
# <p align="center">  Arxiv  [![arXiv](https://img.shields.io/badge/arxiv-2505.12998-red)](https://arxiv.org/abs/2505.12998)  </p>  

### Introduction
Transcranial focused ultrasound (tFUS) is an emerging modality for non-invasive brain stimulation and therapeutic intervention, offering millimeter-scale spatial precision and the ability to target deep brain structures. However, the heterogeneous and anisotropic nature of the human skull introduces significant distortions to the propagating ultrasound wavefront, which require time-consuming patient-specific planning and corrections using numerical solvers for accurate targeting. To enable data-driven approaches in this domain, we introduce TFUScapes, the first large-scale, high-resolution dataset of tFUS simulations through anatomically realistic human skulls derived from T1-weighted MRI images. We have developed a scalable simulation engine pipeline using the k-Wave pseudo-spectral solver, where each simulation returns a steady-state pressure field generated by a focused ultrasound transducer placed at realistic scalp locations.  In addition to the dataset, we present DeepTFUS, a deep learning model that estimates normalized pressure fields directly from input 3D CT volumes and transducer position. The model extends a U-Net backbone with transducer-aware conditioning, incorporating Fourier-encoded position embeddings and MLP layers to create global transducer embeddings. These embeddings are fused with U-Net encoder features via feature-wise modulation, dynamic convolutions, and cross-attention mechanisms. The model is trained using a combination of spatially weighted and gradient-sensitive loss functions, enabling it to approximate high-fidelity wavefields. The TFUScapes dataset is publicly released to accelerate research at the intersection of computational acoustics, neurotechnology, and deep learning.


_This repository contains the link to download the dataset and a visualization script to visualize the data._


## Download the TFUScapes dataset and install the dependencies
The **TFUScapes** dataset is hosted on the [Hugging Face](https://huggingface.co/datasets/vinkle-srivastav/TFUScapes). You can download the dataset and install the dependencies using the commands given below.

```bash
$ TFUScapes=/path/to/tfuscapes/repository
$ git clone https://github.com/CAMMA-public/TFUScapes $TFUScapes
$ cd $TFUScapes/
$ cd dataset && git clone https://huggingface.co/datasets/vinkle-srivastav/TFUScapes && cd ..
$ # Install Python dependencies
$ pip install vtk numpy
```

## 3D Transcranial Focused Ultrasound Visualization with VTK

The Python script [`visualize.py`](visualize.py) provides a fast and interactive 3D visualization of transcranial ultrasound data, including: **cropped pseudo-CT volume**, **corresponding pressure map** and **Transducer coordinates**.

There is sample file (`./sample/TFUScapes/data/A00060925/exp_0.npz`) that can be used to visualize one sample simulation without downloading the data. It uses the [VTK](https://vtk.org/) library for GPU-accelerated volume rendering and 3D point plotting.

### usage
```bash
$ python visualize.py 
# Change the path in the main function (sample_path) to visualize a different sample
```

### Sample visualization
<div align="center">
  <img src="figs/sample_vis_result.png" width="600px" />
</div>

## Models
#### coming soon
##

## Citation
If you use our dataset or code in your research, please cite as:
```bibtex
@article{srivastav2025tfuscapes,
    author    = {Srivastav, Vinkle and Puel, Juliette and Vappou, Jonathan and Houten, Elijah Van and Cabras, Paolo and Padoy, Nicolas},
    title     = {A Skull-Adaptive Framework for AI-Based 3D Transcranial Focused Ultrasound Simulation},
    journal =   {arXiv preprint arXiv:2505.12998},
    year      = {2025},
    note     =  {\url{https://github.com/CAMMA-public/TFUScapes}},
}
```


### Disclaimer

It is important to emphasize that the dataset is intended strictly for research purposes. The dataset **TFUScapes** is **not validated** for clinical decision-making and must not be used as a substitute for certified medical devices or simulation platforms. As with any simulation-based method in biomedical contexts, there remains a risk that third parties could employ these tools beyond their intended scope. To mitigate this, clear disclaimers and licensing restrictions have been implemented to underscore the non-clinical nature of the data and promote responsible use. Broader impact is expected in terms of advancing reproducibility and collaboration in scientific computing, particularly in the development of data-driven methods for neurotechnology and therapeutic ultrasound.


### License
This source code, and dataset are licensed under the license found in the [`LICENSE`](LICENSE) file in the root directory of this source tree.
The **TFUScapes** dataset is publicly released under the Creative Commons license [CC-BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/). This implies that:
- the dataset cannot be used for commercial purposes,
- the dataset can be transformed (additional annotations, etc.),
- the dataset can be redistributed as long as it is redistributed under the same license with the obligation to cite the contributing work which led to the generation of the **TFUScapes** dataset (mentioned above).

By downloading and using this dataset, you agree to these terms and conditions.
